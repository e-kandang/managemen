<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Kandang || Data Jenis</title>
    <link rel="icon" href="assets/images/log2.png">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap.css">
    <link rel="stylesheet" href="assets/vendors/simple-datatables/style.css">
    <link rel="stylesheet" href="assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
    <link rel="stylesheet" href="assets/vendors/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .modal-dialog {
            max-width: 50%; /* Sesuaikan lebar modal */
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
    <div id="app">
        <div id="sidebar" class="active">
            <div class="sidebar-wrapper active">
                <div class="sidebar-header">
                    <div class="d-flex justify-content-between">
                        <div class="logo">
                            <a href="../home.html"><img src="assets/images/manag.png" style="height: 45px;" alt="Logo" srcset=""></a>
                        </div>
                        <div class="toggler">
                            <a href="#" class="sidebar-hide d-xl-none d-block"><i class="bi bi-x bi-middle"></i></a>
                        </div>
                    </div>
                </div>
                <div class="sidebar-menu">
                    <ul class="menu">
                        <li class="sidebar-title">Menu</li>
                        <li class="sidebar-item">
                            <a href="home.html" class='sidebar-link'>
                                <i class="bi bi-grid-fill"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a href="pencarian.html" class='sidebar-link'>
                                <i class="bi bi-search"></i>
                                <span>Pencarian Hewan</span>
                            </a>
                        </li>
                       
                        
                        <li class="sidebar-title">Menu Extra</li>
                        <li class="sidebar-item has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-stack"></i>
                                <span>Data Master</span>
                            </a>
                            <ul class="submenu">
                                <li class="submenu-item">
                                    <a href="karyawan.html">Data Karyawan</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="hewan.html">Data Hewan</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="jenis.html">Data Jenis</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="ras.html">Data Ras</a>
                                </li>
                                <li class="submenu-item active">
                                    <a href="indukan.html">Data Indukan</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="pejantan.html">Data Pejantan</a>
                                </li>
                                
                            </ul>
                        </li>
                        <li class="sidebar-item has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-cash"></i>

                                <span>Transaksi</span>
                            </a>
                            <ul class="submenu">
                                <li class="submenu-item">
                                    <a href="Trnsaksi_masuk.html">Transaksi Masuk</a>
                                </li>
                                
                            </ul>
                        </li>
                        <li class="sidebar-item has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-receipt-cutoff"></i>
                                <span>Pengeluaran</span>
                            </a>
                            <ul class="submenu">
                                <li class="submenu-item">
                                    <a href="pengeluaran_umum.html">Pengeluaran Umum</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="invoice.html">Invoice</a>
                                </li>
                                <li class="submenu-item">
                                    <a href="bon.html">Bon</a>
                                </li>
                                
                            </ul>
                        </li>
                        <li class="sidebar-item has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-pen-fill"></i>
                                <span>Laporan</span>
                            </a>
                            <ul class="submenu">
                                <li class="submenu-item">
                                    <a href="laporanall.html">Laporan All</a>
                                </li>

                            </ul>
                        </li>
                       
                        <!-- <li class="sidebar-item">
                            <a href="pengaturan.html" class='sidebar-link'>
                                <i class="bi bi-gear-fill"></i>
                                <span>Pengaturan</span>
                            </a>
                        </li> -->
                        <li class="sidebar-item">
                            <a href="javascript:void(0);" class="sidebar-link" onclick="logout()">
                                <i class="bi bi-box-arrow-right"></i>

                                <span>Logout</span>
                            </a>
                        </li>
                       
                    </ul>
                </div>
                <button class="sidebar-toggler btn x"><i data-feather="x"></i></button>
            </div>
        </div>
        <div id="main">
            <header class="mb-3">
                <a href="#" class="burger-btn d-block d-xl-none">
                    <i class="bi bi-justify fs-3"></i>
                </a>
            </header>

            <div class="page-heading">
                <div class="page-title">
                    <div class="row">
                        <div class="col-12 col-md-6 order-md-1 order-last">
                            <h3>Data Jenis Hewan</h3>
                        </div>
                        <div class="col-12 col-md-6 order-md-2 order-first">
                            <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="index.html">Dashboard</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">DataTable</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
                <div class="flex justify-end m-3">
                    <a href="kasir.html" class="btn btn-primary">Tambah Transaksi</a>
                    <button onclick="exportToExcel()" class="btn btn-success">Eksport Data</button>
                    <button class="btn btn-danger" onclick="exportToPDF()">Export to PDF</button>
                </div>
                <section class="section">
                    <div class="card">
                        <div class="card-body">
                            <!-- <div class="d-flex justify-content-between mb-3">
                                <a class="mb-0">Data Casis</a>
                                 <input type="text" id="search-input" placeholder="Cari data..." class="form-control w-25" onkeyup="searchTable()"> 
                            </div> -->
                            <div class="table-responsive">
                                <table class="table table-striped" id="table1">
                                    <thead>
                                        <tr>
                                                  <th>ID Transaksi</th>
                                                  <th>Tanggal</th>
                                                  <th>Kode Produk</th>
                                                  <th>Nama Pembeli</th>
                                                  <th>Kontak Pembeli</th>
                                                  <th>Jenis Hewan</th>
                                                  <th>Ras Hewan</th>
                                                  <th>Satuan</th>
                                                  <th>Quantity</th>
                                                  <th>Harga Hewan</th>
                                                  <th>Metode Pembayaran</th>
                                                  <th>Nama Penjual</th>
                                                  <th>No. Rekening</th>
                                                  <th>Atas Nama</th>
                                                  <th>Total</th>
                                                  <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="table-body">
                                        <!-- Data akan dimasukkan di sini -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <footer>
                <div class="footer clearfix mb-0 text-muted">
                    <div class="float-start">
                        <p>2025 &copy; AGA</p>
                    </div>
                    <div class="float-end">
                        <p>By <a
                                href="">Aga Developer</a></p>
                    </div>
                </div>
            </footer>
        </div>
    </div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Update Data</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                
                <form id="editForm">
                    
                    <div class="row">
                        <!-- Left Column -->
                    <div class="col-md-12">
                    <div class="row mb-6 ">
                        <label for="idjenis" class="col-sm-4 col-form-label">ID Jenis</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="idjenis" required readonly>
                        </div>
                    </div>
                    <div class="row mb-6 pt-3">
                        <label for="nama" class="col-sm-4 col-form-label">Jenis</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="jenis" required>
                        </div>
                    </div>
                    
                    <br>
                    <button type ="submit" class="btn btn-primary">Update</button>
                </form>
            </div>
        </div>
    </div>
</div>

    <script src="assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>

    
    <script>
          // Simple Datatable
          let table1 = document.querySelector('#table1');
          let dataTable = new simpleDatatables.DataTable(table1);
      </script>
   
  <script>
      document.addEventListener('DOMContentLoaded', () => {
          const scriptURL = 'https://script.google.com/macros/s/AKfycbzKXfKv2q2DbmYlw-Y00VYl1NdYqAtNwzuf5TggPmRQVEf1vRlbnBzhIklgl-b3eDTO/exec'; // Ganti dengan URL Google Apps Script Anda
          const tableBody = document.querySelector('#table-body');
      
          fetch(scriptURL)
              .then(response => response.json())
              .then(data => {
                  if (!data || data.length === 0) {
                      console.log('No data found.');
                      return;
                  }
      
                  data.forEach(row => {
                      const tr = document.createElement('tr');
                      tr.innerHTML = `
                          <td>${row.idTransaksi || 'N/A'}</td>
                          <td>${row.tanggal ? new Date(row.tanggal).toLocaleDateString('id-ID') : 'N/A'}</td>
                          <td>${row.kodeProduk || 'N/A'}</td>
                          <td>${row.namaPembeli || 'N/A'}</td>
                          <td>${row.kontakPembeli || 'N/A'}</td>
                          <td>${row.jenisHewan || 'N/A'}</td>
                          <td>${row.rasHewan || 'N/A'}</td>
                          <td>${row.satuan || 'N/A'}</td>
                          <td>${row.quantity || 'N/A'}</td>
                          <td>Rp ${row.hargahewan ? parseFloat(row.hargahewan).toLocaleString('id-ID', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : 'N/A'}</td>
                          <td>${row.metodePembayaran || 'N/A'}</td>
                          <td>${row.namaPenjual || 'N/A'}</td>
                          <td>${row.norek || 'N/A'}</td>
                          <td>${row.atasnama || 'N/A'}</td>
                          <td>Rp ${row.total ? parseFloat(row.total).toLocaleString('id-ID', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : 'N/A'}</td>
                          <td>
                              <i class="fa fa-print m-1 text-primary" onclick="printNota('${row.idTransaksi}')"></i>
                              <i class="fa fa-trash m-1 text-danger" onclick="deleteEntry('${row.idTransaksi}')"></i>
                          </td>
                      `;
                      tableBody.appendChild(tr);
                  });
      
      
                  // Inisialisasi Simple DataTable setelah data ditambahkan
                  new simpleDatatables.DataTable(document.querySelector('#table1'));
              })
              .catch(error => {
                  console.error('Error fetching data:', error);
              });
      });
      
  </script>
      <script>
          function searchTable() {
              // Mendapatkan nilai input pencarian
              const input = document.getElementById('search-input');
              const filter = input.value.toLowerCase();
              const table = document.getElementById('table1');
              const tbody = table.getElementsByTagName('tbody')[0];
              const rows = tbody.getElementsByTagName('tr');
  
              // Loop melalui semua baris tabel dan sembunyikan yang tidak cocok
              for (let i = 0; i < rows.length; i++) {
                  const cells = rows[i].getElementsByTagName('td');
                  let found = false;
  
                  // Loop melalui semua sel dalam baris
                  for (let j = 0; j < cells.length; j++) {
                      if (cells[j]) {
                          const cellValue = cells[j].textContent || cells[j].innerText;
                          if (cellValue.toLowerCase().indexOf(filter) > -1) {
                              found = true;
                              break;
                          }
                      }
                  }
  
                  // Tampilkan atau sembunyikan baris berdasarkan pencarian
                  rows[i].style.display = found ? "" : "none";
              }
          }
      </script>
  
      <script>
          function deleteEntry(idTransaksi) {
              // Konfirmasi sebelum menghapus data
              const confirmation = confirm("Apakah Anda yakin ingin menghapus data ini?");
              if (!confirmation) {
                  return; // Batalkan jika pengguna menekan 'No'
              }
          
              const url = 'https://script.google.com/macros/s/AKfycbxEeiUDWMaNPL9jaL1zf2yWUXj_CiBknmbG4pCVRbaLfadiKF0jmaDLFCrrCnxMX08A/exec'; // Ganti dengan URL Google Apps Script Anda
              const params = {
                  func: 'DELETE',
                  idTransaksi: idTransaksi, // Sinkron dengan parameter backend
                  SH: 'Transaksi' // Nama sheet yang sesuai
              };
          
              fetch(url, {
                  method: 'POST',
                  mode: 'no-cors', // Menghindari masalah CORS
                  headers: {
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(params)
              })
              .then(() => {
                  alert("Berhasil: Data berhasil dihapus.");
                  location.reload(); // Refresh halaman setelah penghapusan
              })
              .catch(error => {
                  console.error('Error deleting entry:', error);
                  alert('Terjadi kesalahan saat mencoba menghapus data.');
              });
          }
          
      </script>
  
  <script>
      let currentPage = 1;
  const rowsPerPage = 10;
  
  function displayTable() {
      let tableBody = document.getElementById("table-body");
      let rows = tableBody.getElementsByTagName("tr");
      let totalPages = Math.ceil(rows.length / rowsPerPage) || 1;
      
      for (let i = 0; i < rows.length; i++) {
          rows[i].style.display = (i >= (currentPage - 1) * rowsPerPage && i < currentPage * rowsPerPage) ? "" : "none";
      }
  
      updatePaginationControls(totalPages);
  }
  
  function updatePaginationControls(totalPages) {
      let paginationControls = document.getElementById("pagination");
      paginationControls.innerHTML = "";
  
      let prevButton = document.createElement("button");
      prevButton.textContent = "Previous";
      prevButton.classList.add("btn", "btn-secondary", "mx-1");
      prevButton.disabled = currentPage === 1;
      prevButton.onclick = function () {
          if (currentPage > 1) {
              currentPage--;
              displayTable();
          }
      };
      paginationControls.appendChild(prevButton);
  
      for (let i = 1; i <= totalPages; i++) {
          let button = document.createElement("button");
          button.textContent = i;
          button.classList.add("btn", "btn-primary", "mx-1");
          if (i === currentPage) button.classList.add("active");
          button.onclick = function () {
              currentPage = i;
              displayTable();
          };
          paginationControls.appendChild(button);
      }
  
      let nextButton = document.createElement("button");
      nextButton.textContent = "Next";
      nextButton.classList.add("btn", "btn-secondary", "mx-1");
      nextButton.disabled = currentPage === totalPages;
      nextButton.onclick = function () {
          if (currentPage < totalPages) {
              currentPage++;
              displayTable();
          }
      };
      paginationControls.appendChild(nextButton);
  }
  
  // Panggil fungsi saat data di-load
  document.addEventListener("DOMContentLoaded", function () {
      displayTable();
  });
  
  </script>
      <!-- Simple DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css">
  <!-- Simple DataTables JS -->
  <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest"></script>
  
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
      <script src="assets/js/main.js"></script>
  
      <script>
      function exportToExcel() {
          const table = document.getElementById('table1'); // Ambil elemen tabel
          if (!table) {
              alert("Tabel tidak ditemukan!");
              return;
          }
      
          const workbook = XLSX.utils.book_new(); // Buat workbook baru
      
          // Ambil data dari tabel dan konversi ke worksheet
          const sheetData = [
              Array.from(table.querySelectorAll('thead th')).map(th => th.innerText), // Header tabel
              ...Array.from(table.querySelectorAll('tbody tr')).map(row =>
                  Array.from(row.querySelectorAll('td')).map(cell => cell.innerText)
              ) // Data tabel
          ];
      
          // Hitung total dari kolom "Total" (kolom ke-15, indeks 14)
          let totalSum = 0;
          Array.from(table.querySelectorAll('tbody tr')).forEach(row => {
              const totalCell = row.querySelectorAll('td')[14]; // Kolom ke-15
              if (totalCell) {
                  const totalValue = parseFloat(totalCell.innerText.replace('Rp ', '').replace(/\./g, '').replace(',', '.'));
                  if (!isNaN(totalValue)) {
                      totalSum += totalValue;
                  }
              }
          });
      
          // Tambahkan baris total di bagian bawah tabel
          const totalRow = Array(sheetData[0].length).fill(''); // Buat baris kosong dengan panjang sesuai header
          totalRow[13] = 'Grand Total'; // Kolom ke-14 (Atas Nama)
          totalRow[14] = `Rp ${totalSum.toLocaleString('id-ID', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`; // Kolom ke-15 (Total)
          sheetData.push(totalRow);
      
          // Konversi data ke worksheet
          const worksheet = XLSX.utils.aoa_to_sheet(sheetData);
      
          // Tambahkan border ke setiap sel
          const range = XLSX.utils.decode_range(worksheet['!ref']);
          for (let row = range.s.r; row <= range.e.r; row++) {
              for (let col = range.s.c; col <= range.e.c; col++) {
                  const cellAddress = XLSX.utils.encode_cell({ r: row, c: col });
                  if (!worksheet[cellAddress]) continue; // Lewati jika sel kosong
                  if (!worksheet[cellAddress].s) worksheet[cellAddress].s = {}; // Tambahkan properti style jika belum ada
                  worksheet[cellAddress].s.border = {
                      top: { style: "thin", color: { rgb: "000000" } },
                      bottom: { style: "thin", color: { rgb: "000000" } },
                      left: { style: "thin", color: { rgb: "000000" } },
                      right: { style: "thin", color: { rgb: "000000" } }
                  };
              }
          }
      
          // Tambahkan worksheet ke workbook
          XLSX.utils.book_append_sheet(workbook, worksheet, "Data Transaksi");
      
          // Dapatkan tanggal saat ini
          const currentDate = new Date();
          const formattedDate = currentDate.toISOString().split('T')[0]; // Format YYYY-MM-DD
      
          // Simpan file Excel dengan nama yang mencakup tanggal
          const fileName = `Data_Transaksi_${formattedDate}.xlsx`;
          XLSX.writeFile(workbook, fileName);
      }
  </script>
  
  <script>
  function printNota(idTransaksi) {
    // Cari semua baris tabel dengan ID Transaksi yang sama
    const table = document.getElementById('table1');
    const rows = table.getElementsByTagName('tr');
    const notaDataList = [];

    for (let i = 1; i < rows.length; i++) { // Mulai dari 1 untuk melewati header
        const cells = rows[i].getElementsByTagName('td');
        if (cells[0].innerText === idTransaksi) { // Kolom pertama adalah idTransaksi
            const notaData = {
                idTransaksi: cells[0].innerText,
                tanggal: cells[1].innerText,
                kodeProduk: cells[2].innerText,
                namaPembeli: cells[3].innerText,
                kontakPembeli: cells[4].innerText,
                jenisHewan: cells[5].innerText,
                rasHewan: cells[6].innerText,
                satuan: cells[7].innerText,
                quantity: parseInt(cells[8].innerText), // Konversi ke angka
                harga: parseFloat(cells[9].innerText.replace('Rp ', '').replace(/\./g, '').replace(',', '.')), // Konversi ke angka
                metodePembayaran: cells[10].innerText,
                namaPenjual: cells[11].innerText,
                norek: cells[12].innerText,
                atasnama: cells[13].innerText,
                total: parseFloat(cells[14].innerText.replace('Rp ', '').replace(/\./g, '').replace(',', '.')) // Konversi ke angka
            };
            notaDataList.push(notaData);
        }
    }

    if (notaDataList.length === 0) {
        alert('Data untuk ID Transaksi ini tidak ditemukan!');
        return;
    }

    // Buat konten untuk dicetak
    let printContent = `
        <div style="text-align: center; font-family: Arial, sans-serif; margin-bottom: 20px;">
            <h2 style="margin: 0;">Management Kandang</h2>
            <p style="margin: 0;">Jl. Contoh Alamat No. 123, Kota Contoh</p>
            <p style="margin: 0;">Telp: 0812-3456-7890</p>
            <hr style="border: 1px dashed #000;">
        </div>
        <div style="font-family: Arial, sans-serif; font-size: 14px;">
            <p><strong>ID Transaksi:</strong> ${notaDataList[0].idTransaksi}</p>
            <p><strong>Nama Pembeli:</strong> ${notaDataList[0].namaPembeli}</p>
            <p><strong>Tanggal:</strong> ${notaDataList[0].tanggal}</p>
            <p><strong>Metode Pembayaran:</strong> ${notaDataList[0].metodePembayaran}</p>
            <p><strong>Nama Penjual:</strong> ${notaDataList[0].namaPenjual}</p>
        </div>
        <hr style="border: 1px dashed #000;">
        <table style="width: 100%; font-family: Arial, sans-serif; font-size: 14px; border-collapse: collapse;">
            <thead>
                <tr>
                    <th style="text-align: left;">Kode</th>
                    <th style="text-align: left;">Jenis</th>
                    <th style="text-align: left;">Ras</th>
                    <th style="text-align: right;">Qty</th>
                    <th style="text-align: right;">Harga</th>
                    <th style="text-align: right;">Total</th>
                </tr>
            </thead>
            <tbody>
    `;

    // Tambahkan semua data dengan ID Transaksi yang sama ke tabel
    let grandTotal = 0;
    notaDataList.forEach(notaData => {
        printContent += `
            <tr>
                <td>${notaData.kodeProduk}</td>
                <td>${notaData.jenisHewan}</td>
                <td>${notaData.rasHewan}</td>
                <td style="text-align: right;">${notaData.quantity}</td>
                <td style="text-align: right;">Rp ${notaData.harga.toLocaleString('id-ID', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                <td style="text-align: right;">Rp ${notaData.total.toLocaleString('id-ID', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
            </tr>
        `;
        grandTotal += notaData.total;
    });

    printContent += `
            </tbody>
        </table>
        <hr style="border: 1px dashed #000;">
        <div style="text-align: right; font-family: Arial, sans-serif; font-size: 16px; font-weight: bold;">
            Total Bayar: Rp ${grandTotal.toLocaleString('id-ID', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
        </div>
        <hr style="border: 1px dashed #000;">
        <div style="text-align: center; font-family: Arial, sans-serif; font-size: 12px; margin-top: 20px;">
            <p>Terima kasih atas pembelian Anda!</p>
            <p>Barang yang sudah dibeli tidak dapat dikembalikan.</p>
        </div>
    `;

    // Buka jendela baru untuk mencetak
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html>
            <head>
                <title>Nota Pembelian</title>
                <style>
                    body {
                        font-family: Arial, sans-serif;
                        margin: 20px;
                    }
                    table {
                        width: 100%;
                        border-collapse: collapse;
                    }
                    th, td {
                        padding: 5px;
                        text-align: left;
                        border: 1px solid #ddd;
                    }
                    th {
                        background-color: #f4f4f4;
                    }
                </style>
            </head>
            <body>
                ${printContent}
            </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
}
  </script>
  <script>
      function logout() {
          // Clear the history from local storage
          localStorage.removeItem('selectedClass');
  
          // Redirect to index.html
          window.location.href = 'index.html'; // Change 'index.html' to your actual homepage if different
      }
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
<script>
function exportToPDF() {
    const table = document.getElementById('table1'); // Ambil elemen tabel
    if (!table) {
        alert("Tabel tidak ditemukan!");
        return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({
        orientation: 'landscape', // Mode landscape
        unit: 'mm',               // Satuan ukuran
        format: [210, 330]        // Ukuran halaman F4 (210mm x 330mm)
    });

    // Tambahkan judul laporan
    doc.setFontSize(16);
    doc.text('Laporan Transaksi Masuk', 10, 10);

    // Header tabel yang akan ditampilkan
    const headers = [
        'Tanggal',
        'Kode Produk',
        'Nama Pembeli',
        'Jenis Hewan',
        'Ras Hewan',
        'Satuan',
        'Quantity',
        'Harga Hewan',
        'Total'
    ];

    // Ambil data dari tabel
    const rows = Array.from(table.querySelectorAll('tbody tr')).map(row => {
        const cells = row.querySelectorAll('td');
        return [
            cells[1]?.innerText || 'N/A', // Tanggal
            cells[2]?.innerText || 'N/A', // Kode Produk
            cells[3]?.innerText || 'N/A', // Nama Pembeli
            cells[5]?.innerText || 'N/A', // Jenis Hewan
            cells[6]?.innerText || 'N/A', // Ras Hewan
            cells[7]?.innerText || 'N/A', // Satuan
            cells[8]?.innerText || 'N/A', // Quantity
            cells[9]?.innerText || 'N/A', // Harga Hewan
            cells[14]?.innerText || 'N/A' // Total
        ];
    });

    // Hitung total dari kolom "Total"
    let totalSum = 0;
    rows.forEach(row => {
        const totalValue = parseFloat(row[8]?.replace('Rp ', '').replace(/\./g, '').replace(',', '.') || 0);
        if (!isNaN(totalValue)) {
            totalSum += totalValue;
        }
    });

    // Tambahkan baris total di bagian bawah tabel
    const totalRow = Array(headers.length).fill(''); // Buat baris kosong dengan panjang sesuai header
    totalRow[7] = 'Grand Total'; // Kolom ke-8 (Harga Hewan)
    totalRow[8] = `Rp ${totalSum.toLocaleString('id-ID', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`; // Kolom ke-9 (Total)
    rows.push(totalRow);

    // Tambahkan tabel ke PDF
    doc.autoTable({
        head: [headers],
        body: rows,
        startY: 20,
        styles: {
            fontSize: 10, // Ukuran font
            cellPadding: 3, // Padding sel
        },
        headStyles: {
            fillColor: [0, 123, 255], // Warna header (biru)
            textColor: [255, 255, 255], // Warna teks header (putih)
        },
        footStyles: {
            fillColor: [240, 240, 240], // Warna footer (abu-abu terang)
        },
    });

    // Dapatkan tanggal saat ini
    const currentDate = new Date();
    const formattedDate = currentDate.toISOString().split('T')[0]; // Format YYYY-MM-DD

    // Simpan file PDF dengan nama yang mencakup tanggal
    const fileName = `Laporan_Transaksi_Masuk_${formattedDate}.pdf`;
    doc.save(fileName);
}
</script>
    <!-- Simple DataTables CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css">
<!-- Simple DataTables JS -->
<script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest"></script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="assets/js/main.js"></script>
</body>

</html>